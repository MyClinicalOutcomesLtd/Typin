<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>TypinExamples</title>
    <base href="/" />

    <link href="manifest.json" rel="manifest" />

    <link rel="shortcut icon" href="assets/images/typin-icon/typin-favicon-512px.png">
    <link rel="icon" type="image/png" href="assets/images/typin-icon/typin-favicon-512px.png" sizes="512x512">
    <link rel="apple-touch-icon" sizes="512x512" href="assets/images/typin-icon/typin-favicon-512px.png">

    <link href="assets/css/c-blazor-error-ui.css" rel="stylesheet" />
    <link href="assets/css/styles.css" rel="stylesheet" />
    <link href="_content/Blazored.Toast/blazored-toast.min.css" rel="stylesheet" />
</head>

<body id="body" class="dark">
    <app>
        <header class="container">
            <div class="hero is-full-screen">
                <div class="logo is-center is-vertical-align">

                    <div class="wave-loader">
                        <span class="dot"></span>
                        <span class="dot"></span>
                        <span class="dot"></span>
                    </div>

                    <div class="row is-center">
                        <div class="col-3">
                            <img class="img-zoom-in-out" src="./assets/images/typin-icon/typin-favicon-no-bg-256px.png" alt="Icon">
                        </div>
                    </div>

                    <div class="row is-center">
                        <div class="col">
                            <progress id="progressbar" class="top" value="0" max="8"></progress>
                        </div>
                    </div>

                    <!--<div class="row is-center text-center">
                        <div class="col">
                            <p id="progresbar-percent" class="is-marginless"></p>
                            <p id="progresbar-desc" class="is-marginless"></p>
                        </div>
                    </div>-->

                </div>
            </div>
        </header>
    </app>

    <div class="c-blazor-error-ui">
        An unhandled error has occurred.
        <a href="" class="reload">Reload</a>
        <a class="dismiss">🗙</a>
    </div>

    <!--<script src="_framework/blazor.webassembly.js"></script>-->

    <script type="text/javascript">
        var __loadedDllCounter = 0;
        var __loadedDllTotal = 0;
        window.loadResourceCallback = (keys, name, response) => {
            const progressbar = document.getElementById('progressbar');
            progressbar.value = __loadedDllCounter;

            if (__loadedDllTotal == 0) {
                __loadedDllTotal = keys.length + 8; //TODO add some collection with length for dll and pdb
                progressbar.max = __loadedDllTotal;
            }

            const currentProgress = Math.ceil((++__loadedDllCounter * 100.0) / __loadedDllTotal);
            console.log(`${__loadedDllCounter}/${__loadedDllTotal} (${currentProgress}%) [${name.substr(name.lastIndexOf('.') + 1)}] ${name}`);

            //const progressbarPercent = document.getElementById('progresbar-percent');
            //progressbarPercent.innerHTML = `(${currentProgress}%)`;

            //const progressbarDesc = document.getElementById('progresbar-desc');
            //progressbarDesc.innerHTML = `'${name}'`;
        }

        fetch("_framework/blazor.webassembly.js")
            .then(response => response.text())
            .then(text => {
                const patchedBlazorLoader =
                    text.replace("return r.loadResource(o,t(o),e[o],n)",
                        "var p = r.loadResource(o,t(o),e[o],n); p.response.then((x) => { if (typeof window.loadResourceCallback === 'function') { window.loadResourceCallback(Object.keys(e), o, x);}}); return p;");

                const script = document.createElement('script');
                script.textContent = patchedBlazorLoader;

                document.body.appendChild(script);
            });
    </script>

    <script src="assets/libraries/xterm/xterm.min.js" defer></script>
    <script src="assets/libraries/monaco-editor/min/vs/loader.js" defer></script>
    <script src="assets/js/js-extensions.js" defer></script>
    <script src="assets/js/monaco-editor-interop.js" defer></script>
    <script src="assets/js/xterm-interop.js" defer></script>

    <script>navigator.serviceWorker.register('service-worker.js');</script>
</body>

</html>
